<section id="main_produtos">

    <div class="top">
        <h2>Hardware</h2>
        <button class="btn-of" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling"><i class="bi bi-list"></i> Filtro</button>

        <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
            <div class="header">
                <h5 class="offcanvas-title" id="offcanvasScrollingLabel">FILTRO</h5>
                <button type="button" class="close" data-bs-dismiss="offcanvas" aria-label="Close"><i class="bi bi-x"></i></button>
            </div>
            <hr>
            <div class="offcanvas-body">
                <form id="filterForm">
                    <h5>Valor</h5>
                    <ul>
                        <li><input type="checkbox" class="valorFilter" data-valor="500" id="valor1"> <label for="valor1">R$ 500,00</label></li>
                        <li><input type="checkbox" class="valorFilter" data-valor="1000" id="valor2"> <label for="valor2">R$ 1000,00</label></li>
                        <li><input type="checkbox" class="valorFilter" data-valor="1200" id="valor3"> <label for="valor3">R$ 1200,00</label></li>
                        <li><input type="checkbox" class="valorFilter" data-valor="1500" id="valor4"> <label for="valor4">R$ 1500,00</label></li>
                        <li><input type="checkbox" class="valorFilter" data-valor="2000" id="valor5"> <label for="valor5">R$ 2000,00</label></li>
                        <li><input type="checkbox" class="valorFilter" data-valor="2400" id="valor6"> <label for="valor6">R$ 2400,00</label></li>
                    </ul>
                    <button type="button" class="filtrar" onclick="filtrarProdutos()">Filtrar Agora</button>
                </form>
            </div>
        </div>

    </div>

    <div id="produtos-container" class="produto_flex">
        <!-- Produtos serão carregados aqui via PHP -->
        <?php
        $api = file_get_contents("http://localhost:8080/api/item");
        $produtosInfo = json_decode($api);

        foreach ($produtosInfo as $produto) {
            $parcela = $produto->preco / 10;
            // Exibindo o produto
            echo '<a href="detalheProduto/' . $produto->id_item . '" class="conteiner_produto" data-preco="' . $produto->preco . '">';
            echo '<div class="imagem">';
            $foto = isset($produto->foto) && !empty($produto->foto) ? $produto->foto : 'imagens/default.png';
            echo '<img src="' . $foto . '" alt="Imagem do produto">';
            echo '</div>';
            echo '<div class="descricao">';
            echo '<p class="desc">' . htmlspecialchars($produto->nome) . '</p>';
            $preco = isset($produto->preco) && $produto->preco !== null ? number_format($produto->preco, 2, ',', '.') : 'Preço indisponível';
            echo '<p class="preco">R$ ' . $preco . '</p>';
            echo '<p class="sub_preco">À vista no Pix ou até <span>10x de R$' . number_format($parcela, 2, ',', '.') . 'sem juros</span></p>';
            echo '</div>';
            echo '</a>';
        }
        ?>
    </div>
</section>


<script>
    function filtrarProdutos() {
    // Captura todos os checkboxes selecionados
    let selectedValues = [];
    document.querySelectorAll('.valorFilter:checked').forEach(checkbox => {
        selectedValues.push(parseFloat(checkbox.getAttribute('data-valor')));
    });

    // Filtra os produtos com base nos valores selecionados
    let produtos = document.querySelectorAll('.conteiner_produto');
    produtos.forEach(produto => {
        let precoProduto = parseFloat(produto.getAttribute('data-preco'));
        // Verifica se o preço do produto está dentro dos valores selecionados
        if (selectedValues.length === 0 || selectedValues.includes(precoProduto)) {
            produto.style.display = 'block'; // Exibe o produto
        } else {
            produto.style.display = 'none'; // Oculta o produto
        }
    });
}

</script>